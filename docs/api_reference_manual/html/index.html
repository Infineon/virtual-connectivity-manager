<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Virtual Connectivity Manager Library: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Virtual Connectivity Manager Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Virtual-Connectivity-Manager (VCM) is a library that enables connectivity libraries to add multi-core support through virtualization. Virtualization allows the connectivity stack running on one core to be accessed from another core using Inter-Processor Communication (IPC). With VCM, the connectivity stack can be run on two cores, where one core contains the full connectivity stack (primary core) and the other core contains a subset of virtual-only APIs (secondary core).</p>
<p >Internally, VCM uses IPC to send API requests from the secondary core to the primary core where the API is executed, and then the result is sent back to the secondary core. This makes it seem like the API was executed on the secondary core itself. VCM simplifies the process of adding multi-core support by hiding the details of IPC from both the connectivity libraries and the end application.</p>
<h1><a class="anchor" id="section_features"></a>
Features and functionality</h1>
<p >The current implementation has the following features and functionality:</p><ul>
<li>Supports the following WCM virtual APIs:<ul>
<li>cy_wcm_is_connected_to_ap</li>
<li>cy_wcm_register_event_callback</li>
<li>cy_wcm_deregister_event_callback</li>
</ul>
</li>
<li>Supports the following MQTT virtual APIs:<ul>
<li>cy_mqtt_get_handle</li>
<li>cy_mqtt_register_event_callback</li>
<li>cy_mqtt_deregister_event_callback</li>
<li>cy_mqtt_subscribe</li>
<li>cy_mqtt_unsubscribe</li>
<li>cy_mqtt_publish</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="section_supported_platforms"></a>
Supported platforms</h1>
<p >This library and its features are supported on the following Infineon platforms:</p><ul>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-MUR-43439M2)</a></li>
</ul>
<h1><a class="anchor" id="section_dependencies"></a>
Dependent libraries</h1>
<p >This library is not bundled as part of any other library by default.</p>
<h1><a class="anchor" id="section_integration"></a>
Quick start</h1>
<ul>
<li>Define the following compile-time macro in the project Makefile of primary core side: <div class="fragment"><div class="line">DEFINES+=ENABLE_MULTICORE_CONN_MW</div>
</div><!-- fragment --></li>
<li>Define the following compile-time macros in the project Makefile of secondary core side: <div class="fragment"><div class="line">DEFINES+=ENABLE_MULTICORE_CONN_MW USE_VIRTUAL_API</div>
</div><!-- fragment --></li>
<li>To use MQTT virtual APIs, define the following compile-time macro in the project Makefile of both cores: <div class="fragment"><div class="line">DEFINES+=VCM_ENABLE_MQTT</div>
</div><!-- fragment --></li>
<li>Call the <a class="el" href="group__group__vcm__functions.html#ga90b3850590540d4484f32ccb2cedc840">cy_vcm_init()</a> function provided by the VCM library in both the projects. <dl class="section note"><dt>Note</dt><dd>- To ensure that the VCM initialization is synchronized, the project which boots first (i.e., CM0+ project in case of psoc62) must call <a class="el" href="group__group__vcm__functions.html#ga90b3850590540d4484f32ccb2cedc840">cy_vcm_init</a> before it brings up the second project (i.e., CM4 project in case of psoc62). </dd>
<dd>
- The first project must initialize VCM by passing <em>config.hal_resource_opt</em> as <em>CY_VCM_CREATE_HAL_RESOURCE</em> in <em>cy_vcm_init</em>. The second project must pass <em>config.hal_resource_opt</em> as <em>CY_VCM_USE_HAL_RESOURCE</em>. </dd>
<dd>
- VCM initialization can also be done in any order from any core provided that the first project initializing VCM sets <em>config.hal_resource_opt</em> as <em>CY_VCM_CREATE_HAL_RESOURCE</em> in <em>cy_vcm_init</em> and the second project sets <em>config.hal_resource_opt</em> as <em>CY_VCM_USE_HAL_RESOURCE</em>. In this case synchronizing VCM initialization between the two cores will be the responsibility of the application. If not synchronised correctly, this can lead to unexpected behaviour.</dd></dl>
</li>
<li>VCM utilizes HAL IPC queue resource to perform inter-core communication. Each HAL IPC queue is associated with a <em>channel number</em> and <em>queue number</em>. For a given <em>channel number</em> (provided by the application during VCM initialization), VCM uses <em>queue numbers</em> in the range of 1-7 which should not be used by the application while using VCM. <table class="doxtable">
<tr>
<th>Channel Number </th><th>Queue Number </th></tr>
<tr>
<td>Any IPC Channel configured by the application for VCM </td><td>1-7(Reserved by VCM) </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The application cannot use queue numbers 1-7 for the configured channel number, as they are reserved for VCM.</dd></dl>
</li>
<li>VCM utilizes one of the IPC queues to send asynchronous event callback data from the primary core to the secondary core. By default, the size of this queue is set to 20. However, if the application expects to receive event callbacks in the secondary core in large bursts, this queue size can be modified to avoid queue overflow. To customize the event queue size, define and set the <em>CY_VCM_EVENT_QUEUE_SIZE</em> macro in the Makefile of the project which initializes VCM with <em>config.hal_resource_opt</em> as <em>CY_VCM_CREATE_HAL_RESOURCE</em>. For e.g., the Makefile entry for updating the queue size to 25 would be as follows: <div class="fragment"><div class="line">DEFINES+=CY_VCM_EVENT_QUEUE_SIZE=25</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="section_debug_logs_in_vcm"></a>
Enable debug logs in VCM library</h1>
<h2><a class="anchor" id="section_vcm_log_message"></a>
Enable VCM log messages</h2>
<p >The VCM library disables all the debug log messages by default. To enable log messages, the application must perform the following:</p><ul>
<li>To enable VCM logs in a dual-core application, add the <code>ENABLE_VCM_LOGS</code> macro to the <em>DEFINES</em> in the project Makefile. Depending on where the VCM logs need to be enabled, you can add this macro to either side of the project Makefile. <div class="fragment"><div class="line">DEFINES+=ENABLE_VCM_LOGS</div>
</div><!-- fragment --></li>
<li>Call the <em>cy_log_init()</em> function provided by the <em>cy-log</em> module. cy-log is part of the <em>connectivity-utilities</em> library. See <a href="https://Infineon.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">connectivity-utilities library API documentation</a>.</li>
</ul>
<h2><a class="anchor" id="section_enable_logs_in_dual_core"></a>
Enable logs in dual core application</h2>
<p >To enable debug log messages on both cores, the application needs to reserve two distinct UART ports. If you are using one of Infineon's BSPs for the connectivity application, you can use the on-board KitProg3 USB-UART COM port to print debug logs for one core. However, you still need another USB-UART bridge to print debug logs for the other core.</p><ul>
<li>One core can use the default CYBSP_DEBUG_UART_TX and CYBSP_DEBUG_UART_RX pins to enable the SCB block for KitProg3 using the retarget-io library. <div class="fragment"><div class="line">cy_retarget_io_init(CYBSP_DEBUG_UART_TX, CYBSP_DEBUG_UART_RX, CY_RETARGET_IO_BAUDRATE);</div>
</div><!-- fragment --></li>
<li>The other core can use any of the remaining SCB blocks to select the appropriate TX and RX pins. These TX and RX pins can be configured using the retarget-io library.<ul>
<li>For example, in the CY8CEVAL-062S2-MUR-43439M2 board, the following pins can be configured for an additional UART port.<ul>
<li>P13.4 and P13.5 (CYBSP_MIKROBUS_UART_RX, CYBSP_MIKROBUS_UART_TX)</li>
<li>P5.4 and P5.5 (CYBSP_D4, CYBSP_D5) <div class="fragment"><div class="line">cy_retarget_io_init(CYBSP_D5, CYBSP_D4, CY_RETARGET_IO_BAUDRATE);</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>For the second core, the selected TX and RX pins can be connected to an external USB-UART bridge (FTDI) using jumper wires, which will be emulated as a UART COM port.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="section_code_snippet"></a>
Code snippets</h1>
<h2><a class="anchor" id="snip1"></a>
Snippet 1: Initialize VCM</h2>
<p >The following snippet demonstrates how to initialize the VCM library on two cores.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">/***************************** Secondary core ***************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Flag to be set when VCM initialization is completed on the other core */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> is_vcm_init_complete = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* VCM callback registered in the secondary core to handle events from VCM. */</span></div>
<div class="line"><span class="keywordtype">void</span> vcm_callback_sec_core(<a class="code hl_enumeration" href="group__group__vcm__enums.html#ga7442d31f511ef3c01f4c68caf96eb5a8">cy_vcm_event_t</a> event)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>(event)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8a4797bbe32ca2fa7aeee7401a7dffeff4">CY_VCM_EVENT_INIT_COMPLETE</a>:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* VCM init complete */</span></div>
<div class="line">            is_vcm_init_complete = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_vcm_init_sec_core()</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the VCM library on the core that is brought up first. */</span></div>
<div class="line">    <a class="code hl_struct" href="structcy__vcm__config__t.html">cy_vcm_config_t</a> config;</div>
<div class="line"> </div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#aaa1bef763941e8e0e2b9d17b9afba347">hal_resource_opt</a> = <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga93ea290ac24436653331b97a293d8511a46e8c2104532a1bbd059f7d8afd0696d">CY_VCM_CREATE_HAL_RESOURCE</a>;</div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#af46b69e963ce49adbcdaaffec32bc067">channel_num</a> = CYHAL_IPC_CHAN_0;</div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#a7ca8a7f9ca3cdfe6ab14d6b7a106b26f">event_cb</a> = vcm_callback_sec_core;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize VCM */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__vcm__functions.html#ga90b3850590540d4484f32ccb2cedc840">cy_vcm_init</a>(&amp;config);</div>
<div class="line">    <span class="keywordflow">if</span>(result != CY_RSLT_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n cy_vcm_init failed on core 1....!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Enable the other core. </span></div>
<div class="line"><span class="comment">     * For example, for enabling CM4, the following code is applicable. </span></div>
<div class="line"><span class="comment">     * When this is called, the application on the primary core will begin executing. Ensure cy_vcm_init()</span></div>
<div class="line"><span class="comment">     * is called on the second core when the execution begins.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    Cy_SysEnableCM4(CY_CORTEX_M4_APPL_ADDR);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Wait for CY_VCM_EVENT_INIT_COMPLETE event in the callback. */</span></div>
<div class="line">    <span class="keywordflow">while</span> ( !is_vcm_init_complete )</div>
<div class="line">    {</div>
<div class="line">        cy_rtos_delay_milliseconds(1000);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Proceed to use virtual APIs from the secondary core. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************** Primary core ***************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* VCM callback registered by core 2 application to handle events from VCM. */</span></div>
<div class="line"><span class="keywordtype">void</span> vcm_callback_prim_core(<a class="code hl_enumeration" href="group__group__vcm__enums.html#ga7442d31f511ef3c01f4c68caf96eb5a8">cy_vcm_event_t</a> event)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(event)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8adc18bb166e7f1c0135ce8aa0f52b4811">CY_VCM_EVENT_DEINIT</a>:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Handle remote deinit */</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_vcm_init_prim_core()</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* When the primary core is enabled, initalize VCM library with the below configurations. */</span></div>
<div class="line">    <a class="code hl_struct" href="structcy__vcm__config__t.html">cy_vcm_config_t</a> config;</div>
<div class="line"> </div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#aaa1bef763941e8e0e2b9d17b9afba347">hal_resource_opt</a> = <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga93ea290ac24436653331b97a293d8511a52e81e77226331e21886d507c470b2c9">CY_VCM_USE_HAL_RESOURCE</a>;</div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#af46b69e963ce49adbcdaaffec32bc067">channel_num</a> = CYHAL_IPC_CHAN_0;</div>
<div class="line">    config.<a class="code hl_variable" href="structcy__vcm__config__t.html#a7ca8a7f9ca3cdfe6ab14d6b7a106b26f">event_cb</a> = vcm_callback_prim_core;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize VCM. This will cause CY_VCM_EVENT_INIT_COMPLETE event to be received on the secondary core. */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__vcm__functions.html#ga90b3850590540d4484f32ccb2cedc840">cy_vcm_init</a>(&amp;config);</div>
<div class="line">    <span class="keywordflow">if</span>(result != CY_RSLT_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\ncy_vcm_init failed on the primary core....!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Proceed with the rest of the application logic. */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__vcm__enums_html_ga7442d31f511ef3c01f4c68caf96eb5a8"><div class="ttname"><a href="group__group__vcm__enums.html#ga7442d31f511ef3c01f4c68caf96eb5a8">cy_vcm_event_t</a></div><div class="ttdeci">cy_vcm_event_t</div><div class="ttdoc">Virtual-Connectivity-Manager event type.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:75</div></div>
<div class="ttc" id="agroup__group__vcm__enums_html_gga7442d31f511ef3c01f4c68caf96eb5a8a4797bbe32ca2fa7aeee7401a7dffeff4"><div class="ttname"><a href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8a4797bbe32ca2fa7aeee7401a7dffeff4">CY_VCM_EVENT_INIT_COMPLETE</a></div><div class="ttdeci">@ CY_VCM_EVENT_INIT_COMPLETE</div><div class="ttdoc">Event generated on the core which initializes VCM first when VCM initialization is complete on both c...</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:76</div></div>
<div class="ttc" id="agroup__group__vcm__enums_html_gga7442d31f511ef3c01f4c68caf96eb5a8adc18bb166e7f1c0135ce8aa0f52b4811"><div class="ttname"><a href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8adc18bb166e7f1c0135ce8aa0f52b4811">CY_VCM_EVENT_DEINIT</a></div><div class="ttdeci">@ CY_VCM_EVENT_DEINIT</div><div class="ttdoc">Event generated on a core when the other core initiates VCM de-initialization.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:77</div></div>
<div class="ttc" id="agroup__group__vcm__enums_html_gga93ea290ac24436653331b97a293d8511a46e8c2104532a1bbd059f7d8afd0696d"><div class="ttname"><a href="group__group__vcm__enums.html#gga93ea290ac24436653331b97a293d8511a46e8c2104532a1bbd059f7d8afd0696d">CY_VCM_CREATE_HAL_RESOURCE</a></div><div class="ttdeci">@ CY_VCM_CREATE_HAL_RESOURCE</div><div class="ttdoc">Option to be set during cy_vcm_init in the core which initializes VCM first.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:86</div></div>
<div class="ttc" id="agroup__group__vcm__enums_html_gga93ea290ac24436653331b97a293d8511a52e81e77226331e21886d507c470b2c9"><div class="ttname"><a href="group__group__vcm__enums.html#gga93ea290ac24436653331b97a293d8511a52e81e77226331e21886d507c470b2c9">CY_VCM_USE_HAL_RESOURCE</a></div><div class="ttdeci">@ CY_VCM_USE_HAL_RESOURCE</div><div class="ttdoc">Option to be set during cy_vcm_init in the core which initializes VCM second.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:87</div></div>
<div class="ttc" id="agroup__group__vcm__functions_html_ga90b3850590540d4484f32ccb2cedc840"><div class="ttname"><a href="group__group__vcm__functions.html#ga90b3850590540d4484f32ccb2cedc840">cy_vcm_init</a></div><div class="ttdeci">cy_rslt_t cy_vcm_init(cy_vcm_config_t *config)</div><div class="ttdoc">Initializes the virtual connectivity manager.</div></div>
<div class="ttc" id="astructcy__vcm__config__t_html"><div class="ttname"><a href="structcy__vcm__config__t.html">cy_vcm_config_t</a></div><div class="ttdoc">Virtual-Connectivity-Manager config structure.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:124</div></div>
<div class="ttc" id="astructcy__vcm__config__t_html_a7ca8a7f9ca3cdfe6ab14d6b7a106b26f"><div class="ttname"><a href="structcy__vcm__config__t.html#a7ca8a7f9ca3cdfe6ab14d6b7a106b26f">cy_vcm_config_t::event_cb</a></div><div class="ttdeci">cy_vcm_event_callback_t event_cb</div><div class="ttdoc">Callback function which receives the VCM events.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:127</div></div>
<div class="ttc" id="astructcy__vcm__config__t_html_aaa1bef763941e8e0e2b9d17b9afba347"><div class="ttname"><a href="structcy__vcm__config__t.html#aaa1bef763941e8e0e2b9d17b9afba347">cy_vcm_config_t::hal_resource_opt</a></div><div class="ttdeci">cy_vcm_hal_resource_opt_t hal_resource_opt</div><div class="ttdoc">This is used to identify the core that should create the HAL resources.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:125</div></div>
<div class="ttc" id="astructcy__vcm__config__t_html_af46b69e963ce49adbcdaaffec32bc067"><div class="ttname"><a href="structcy__vcm__config__t.html#af46b69e963ce49adbcdaaffec32bc067">cy_vcm_config_t::channel_num</a></div><div class="ttdeci">uint32_t channel_num</div><div class="ttdoc">IPC channel number passed by user during initialization (e.g.</div><div class="ttdef"><b>Definition:</b> cy_vcm.h:126</div></div>
</div><!-- fragment --><h2><a class="anchor" id="snip2"></a>
Snippet 2: Deinitialize VCM</h2>
<p >The following snippet demonstrates how to deinitialize the VCM library from two cores.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">/***************************** Secondary core ***************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Flag that is set when VCM deinit is started by the other core. </span></div>
<div class="line"><span class="comment"> * When this event is received, call cy_vcm_deinit() to deinitialize VCM</span></div>
<div class="line"><span class="comment"> * on the current core.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> is_vcm_deinit_requested_1 = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* VCM callback registered in secondary core to handle events from VCM. */</span></div>
<div class="line"><span class="keywordtype">void</span> vcm_callback_prim_core_2(<a class="code hl_enumeration" href="group__group__vcm__enums.html#ga7442d31f511ef3c01f4c68caf96eb5a8">cy_vcm_event_t</a> event)</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>(event)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8adc18bb166e7f1c0135ce8aa0f52b4811">CY_VCM_EVENT_DEINIT</a>:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* The other core has initiated VCM deinit. Deinitialize VCM locally. */</span></div>
<div class="line">            is_vcm_deinit_requested_1 = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Secondary core initiates VCM deinitialization. */</span></div>
<div class="line"><span class="keywordtype">void</span> snippet_vcm_deinit_sec_core()</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* VCM initialized on both cores */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ... */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* VCM is no longer needed. Call deinit on secondary core. */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__vcm__functions.html#ga942cb710358237f8d857d6f195564cc2">cy_vcm_deinit</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\ncy_vcm_deinit failed on core 1!...\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************** Primary core ***************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Flag that is set when VCM deinit is started by the other core. </span></div>
<div class="line"><span class="comment"> * When this event is received, call cy_vcm_deinit() to deinitialize VCM</span></div>
<div class="line"><span class="comment"> * on the current core.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> is_vcm_deinit_requested = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* VCM callback registered in primary core to handle events from VCM. */</span></div>
<div class="line"><span class="keywordtype">void</span> vcm_callback_prim_core_2(<a class="code hl_enumeration" href="group__group__vcm__enums.html#ga7442d31f511ef3c01f4c68caf96eb5a8">cy_vcm_event_t</a> event)</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>(event)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__group__vcm__enums.html#gga7442d31f511ef3c01f4c68caf96eb5a8adc18bb166e7f1c0135ce8aa0f52b4811">CY_VCM_EVENT_DEINIT</a>:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* The other core has initiated VCM deinit. Deinitialize VCM locally. */</span></div>
<div class="line">            is_vcm_deinit_requested = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Primary core waits for deinit to be started by the secondary core. When CY_VCM_EVENT_DEINIT</span></div>
<div class="line"><span class="comment"> * event is received in the application callback, VCM is deinitialized locally.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> snippet_vcm_deinit_prim_core()</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* VCM initialized on both cores */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ... */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Wait for deinit to be initiated from the other core. */</span></div>
<div class="line">    <span class="keywordflow">while</span>( !is_vcm_deinit_requested )</div>
<div class="line">    {</div>
<div class="line">        cy_rtos_delay_milliseconds(1000);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* VCM deinit event received. Call deinit. */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__vcm__functions.html#ga942cb710358237f8d857d6f195564cc2">cy_vcm_deinit</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n cy_vcm_deinit failed on primary core! \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__group__vcm__functions_html_ga942cb710358237f8d857d6f195564cc2"><div class="ttname"><a href="group__group__vcm__functions.html#ga942cb710358237f8d857d6f195564cc2">cy_vcm_deinit</a></div><div class="ttdeci">cy_rslt_t cy_vcm_deinit()</div><div class="ttdoc">De-initializes the virtual connectivity manager.</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Virtual Connectivity Manager Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
</body>
</html>
